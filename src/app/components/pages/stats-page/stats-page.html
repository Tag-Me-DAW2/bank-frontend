<div class="stats-page">
    <!-- ─── Left: Summary & Bars ─── -->
    <div class="stats-page__left-side">
        <h2 class="stats-page__section-title">Resumen Mensual</h2>

        <div class="stats-page__summary-cards">
            <div class="stats-page__summary-card stats-page__summary-card--expenses">
                <div class="stats-page__summary-icon">
                    <i class='bx bx-trending-down'></i>
                </div>
                <div class="stats-page__summary-info">
                    <span class="stats-page__summary-label">Gastos</span>
                    <span class="stats-page__summary-value">{{ monthlyExpenses | currency }}</span>
                </div>
            </div>
            <div class="stats-page__summary-card stats-page__summary-card--income">
                <div class="stats-page__summary-icon">
                    <i class='bx bx-trending-up'></i>
                </div>
                <div class="stats-page__summary-info">
                    <span class="stats-page__summary-label">Ingresos</span>
                    <span class="stats-page__summary-value">{{ monthlyIncome | currency }}</span>
                </div>
            </div>
        </div>

        <div class="stats-page__chart-container">
            <div class="stats-page__chart-bar-wrapper">
                <div class="stats-page__chart-bar stats-page__chart-bar--expenses"
                    [style.height.%]="expensesPercentage">
                </div>
                <span class="stats-page__chart-bar-name">Gastos</span>
            </div>
            <div class="stats-page__chart-bar-wrapper">
                <div class="stats-page__chart-bar stats-page__chart-bar--income" [style.height.%]="incomePercentage">
                </div>
                <span class="stats-page__chart-bar-name">Ingresos</span>
            </div>
        </div>
    </div>

    <!-- ─── Right: Calendar & Daily ─── -->
    <div class="stats-page__right-side">
        <mat-calendar #calendar class="stats-page__calendar" [selected]="selectedDate"
            (selectedChange)="onDateChange($event)" (monthSelected)="onMonthChange($event)"
            [dateClass]="dateClass"></mat-calendar>

        <div class="stats-page__daily-movements">
            <h3 class="stats-page__daily-title">
                <i class='bx bx-calendar'></i>
                {{ selectedDate | date:'d MMMM yyyy' }}
            </h3>

            @if (dailyMovements.length > 0) {
            @for (movement of dailyMovements; track $index) {
            <a class="stats-page__daily-movement-item" [routerLink]="['/bank/movements/', accountId]"
                [queryParams]="{ movementId: movement.id }">
                <span class="stats-page__movement-icon">
                    <i class="bx" [ngClass]="{
                                'bx-trending-up': movement.type == 'DEPOSIT',
                                'bx-trending-down': movement.type == 'WITHDRAWAL'
                            }"></i>
                </span>
                <div class="stats-page__movement-central-info">
                    <span class="stats-page__movement-description">
                        @switch (movement.type) {
                        @case ('DEPOSIT') { Depósito }
                        @case ('WITHDRAWAL') { Retiro }
                        }
                    </span>
                    <span class="stats-page__movement-origin">
                        @switch (movement.origin) {
                        @case ('BANK_ACCOUNT') { <i class='bx bxs-bank'></i> Cuenta }
                        @case ('BANK_CARD') { <i class='bx bxs-credit-card'></i> Tarjeta }
                        @case ('DOMICILIATION') { <i class='bx bxs-home'></i> Domiciliación }
                        }
                    </span>
                </div>
                <span class="stats-page__movement-amount" [ngClass]="{
                            'stats-page__movement-amount--deposit': movement.type == 'DEPOSIT',
                            'stats-page__movement-amount--withdrawal': movement.type == 'WITHDRAWAL'
                        }">
                    {{ movement.type == 'DEPOSIT' ? '+' : '-' }}{{ movement.amount | currency }}
                </span>
            </a>
            }
            } @else {
            <div class="stats-page__no-movements">
                <i class='bx bx-calendar-x'></i>
                <span>No hay movimientos este día</span>
            </div>
            }
        </div>
    </div>
</div>